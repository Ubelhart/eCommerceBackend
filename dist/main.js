(()=>{"use strict";var t={505:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(r(752)),n=o(r(566)),s=o(r(1)),d=o(r(37)),u=r(752),c=d.default.cpus().length,a=(0,n.default)(process.argv.slice(2)),l=(0,n.default)(process.argv.slice(3)),f=process.env.PORT||a._[0]||8080,h={"Argumentos de entrada":process.argv,"Nombre de la plataforma: ":process.platform,"Versión de Node: ":process.version,"Memoria total reservada":process.memoryUsage().heapTotal,"Path de ejecución":process.execPath,"Process id":process.pid,"Número de procesadores presentes en el servidor":"CLUSTER"===l._[0]?c:1,"Carpeta del proyecto":__dirname,Port:f};if(i.default.get("/info",((t,e)=>{e.json(h)})),i.default.get("*",((t,e)=>{u.logger.warn("Ruta no existente"),e.send("Ruta no existente")})),"CLUSTER"===l._[0])if(s.default.isPrimary){console.log("Master cluster setting up");for(let t=0;t<c;t++)s.default.fork();s.default.on("exit",(t=>{console.log(`worker ${t.process.pid} died`)}))}else i.default.listen(f,(()=>{console.log(`Servidor corriendo en http://localhost:${f}`)})),console.log(`Worker ${process.pid} started`);else i.default.listen(f,(()=>{console.log(`Servidor corriendo en http://localhost:${f}`)}))},752:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.logger=void 0,r(81);const i=o(r(860)),n=o(r(114)),s=o(r(422)),d=o(r(455)),u=o(r(508)),c=o(r(511)),a=r(55),l=o(r(96)),f=o(r(12)),h=o(r(773)),p=(0,i.default)();function v(t){return l.default.hashSync(t,l.default.genSaltSync(10),null)}e.logger=h.default.createLogger({transports:[new h.default.transports.Console({level:"info"}),new h.default.transports.File({filename:"warn.log",level:"warn"}),new h.default.transports.File({filename:"error.log",level:"error"})]}),p.use((0,d.default)()),p.use("/api/carrito",(new n.default).router),p.use("/api/productos",(new s.default).router),p.use((0,u.default)({secret:"secreto",cookie:{httpOnly:!1,secure:!1,maxAge:6e5},rolling:!0,resave:!0,saveUninitialized:!1})),p.use(c.default.initialize()),p.use(c.default.session()),p.set("views","./views"),p.set("view engine","ejs"),c.default.use("login",new a.Strategy(((t,e,r)=>{f.default.findOne({username:t},((t,o)=>t?r(t):o?function(t,e){return l.default.compareSync(e,t.password)}(o,e)?r(null,o):(console.log("Contraseña incorrecta"),r(null,!1)):(console.log("Usuario no encontrado"),r(null,!1))))}))),c.default.use("signup",new a.Strategy({passReqToCallback:!0},((t,e,r,o)=>{f.default.findOne({username:e},((t,i)=>{if(t)return o(t);if(i)return console.log("Usuario ya existe"),o(null,!1);const n=new f.default({username:e,password:v(r)});n.save((t=>t?o(t):o(null,n)))}))}))),c.default.serializeUser((({_id:t},e)=>{e(null,t)})),c.default.deserializeUser(((t,e)=>{f.default.findById(t,((t,r)=>t?e(t):e(null,r)))})),p.get("/",((t,e)=>{e.send("Probando Heroku")})),p.get("/register",((t,e)=>{e.render("register")})),p.post("/register",c.default.authenticate("signup",{successRedirect:"/login",failureRedirect:"/failregister"})),p.get("/failregister",((t,r)=>{e.logger.info("Fallo al registrar usuario"),r.render("failregister")})),p.get("/login",((t,e)=>{e.render("login")})),p.post("/login",c.default.authenticate("login",{successRedirect:"/",failureRedirect:"/faillogin"})),p.get("/faillogin",((t,r)=>{e.logger.info("Fallo al iniciar sesión"),r.render("faillogin")})),p.get("/logout",((t,r)=>{if(t.user){const{username:o}=t.user;return t.logOut((t=>t?(e.logger.error(t),r.redirect("/login")):r.render("logout",{username:o})))}r.redirect("/login")})),p.get("/api/randoms",((t,e)=>{const{cant:r}=t.query,o=Number(r)||1e5,i=[];for(let t=0;t<o;t++)i.push(Math.floor(1e3*Math.random()));e.json(i)})),e.default=p},802:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r){"true"===t.headers.admin?r():e.status(401).json({error:"No autorizado"})}},913:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.serviceAccount=e.sqlite3=e.mariadb=e.mongoDbKey=void 0,r(81),e.mongoDbKey=process.env.MONGO||"mongodb://localhost:27017/ecommerce",e.mariadb={client:"mysql",connection:{host:"127.0.0.1",user:"root",password:"",database:"ecommerce"}},e.sqlite3={client:"sqlite3",connection:{filename:"./src/db/mydb.sqlite"},useNullAsDefault:!0},e.serviceAccount={type:process.env.FIREBASE_type,project_id:process.env.FIREBASE_project_id,private_key_id:process.env.FIREBASE_private_key_id,private_key:process.env.FIREBASE_private_key,client_email:process.env.FIREBASE_client_email,client_id:process.env.FIREBASE_client_id,auth_uri:process.env.FIREBASE_auth_uri,token_uri:process.env.FIREBASE_token_uri,auth_provider_x509_cert_url:process.env.FIREBASE_auth_provider_x509_cert_url,client_x509_cert_url:process.env.FIREBASE_client_x509_cert_url}},89:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=r(147);e.default=class{constructor(t){this.fileName=t,this.config=`./db/${t}`,this.fs=i.promises}createIfNotExist(){return o(this,void 0,void 0,(function*(){try{return yield i.promises.readFile(this.config)}catch(t){if("ENOENT"===t.code)return yield i.promises.writeFile(this.config,"[]").then((()=>{console.log(`No existe ${this.fileName}. Archivo creado.`)})),yield i.promises.readFile(this.config);console.log("Hubo un error",t)}return null}))}}},627:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(r(509));e.default=class{constructor(t){this.config=t,this.admin=i.default}connect(){i.default.initializeApp({credential:i.default.credential.cert(this.config)}),console.log("Firebase connected")}}},231:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(r(514));e.default=class{constructor(t){this.knex=(0,i.default)(t)}}},135:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(185));e.default=class{constructor(t){this.config=t}connect(){return o(this,void 0,void 0,(function*(){try{yield n.default.connect(this.config),console.log("MongoDB connected")}catch(t){console.log("MongoDB connection error",t)}}))}}},817:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=r(971);e.default=class{constructor(){this.postCart=this.postCart.bind(this),this.deleteCart=this.deleteCart.bind(this),this.getCart=this.getCart.bind(this),this.postProduct=this.postProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}postCart(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoCarts.postCart(t.body);return(yield i.daoCarts.getCart(r.id))?e.json(`El carrito con el id:${r.id} ha sido agregado`):e.json({error:"no se pudo agregar el carrito"})}catch(t){return e.status(500).json({error:t.message})}}))}deleteCart(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoCarts.getCart(t.params.id);return r?(yield i.daoCarts.deleteCart(r),e.json(`El carrito con el id:${r.id} ha sido eliminado`)):e.json({error:`el carrito con el id:${t.params.id} no existe`})}catch(t){return e.status(500).json({error:t.message})}}))}getCart(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoCarts.getCart(t.params.id);return r?e.json(r):e.json({error:`el carrito con el id:${t.params.id} no existe`})}catch(t){return e.status(500).json({error:t.message})}}))}postProduct(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoCarts.getCart(t.params.id);if(r){const o=yield i.daoCarts.postProduct(r,t.body);return o?e.json(`El producto con el id:${o.id} ha sido agregado`):e.json({error:`el producto no pudo ser agregado al carrito con el id:${t.params.id}`})}return e.json({error:`el carrito con el id:${t.params.id} no existe`})}catch(t){return e.status(500).json({error:t.message})}}))}deleteProduct(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoCarts.getCart(t.params.id);if(r){const o=yield i.daoCarts.deleteProduct(r,t.params.id_prod);return o?e.json(`El producto con el id:${o.id} ha sido eliminado`):e.json({error:`el producto con el id:${t.params.id_prod} no existe en el carrito con el id:${t.params.id}`})}return e.json({error:`el carrito con el id:${t.params.id}`})}catch(t){return e.status(500).json({error:t.message})}}))}}},243:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=r(971),n=r(752);e.default=class{constructor(){this.getProducts=this.getProducts.bind(this),this.postProduct=this.postProduct.bind(this),this.getProduct=this.getProduct.bind(this),this.putProduct=this.putProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}getProducts(t,e){return o(this,void 0,void 0,(function*(){if(t.params.id)try{const r=yield i.daoProducts.getProduct(t.params.id);return r?e.json(r):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}else try{const t=yield i.daoProducts.getProducts();return t?e.json(t):e.json({error:"no hay productos"})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}}))}getProduct(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoProducts.getProduct(t.params.id);return r?e.json(r):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}}))}postProduct(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoProducts.postProduct(t.body);return(yield i.daoProducts.getProduct(r.id))?e.json(`El producto con el id:${r.id} ha sido creado`):e.json({error:"no se pudo crear el producto"})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}}))}putProduct(t,e){return o(this,void 0,void 0,(function*(){try{if(yield i.daoProducts.getProduct(t.params.id)){const r=yield i.daoProducts.putProduct(t.params.id,t.body);return e.json(`El producto con el id:${r.id} ha sido actualizado`)}return e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}}))}deleteProduct(t,e){return o(this,void 0,void 0,(function*(){try{const r=yield i.daoProducts.getProduct(t.params.id);return r?(yield i.daoProducts.deleteProduct(r),e.json(`El producto con el id:${r.id} ha sido eliminado`)):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return n.logger.error(t.message),e.status(500).json({message:t.message})}}))}}},808:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(89));class s extends n.default{constructor(t){super(t)}getCarts(){return o(this,void 0,void 0,(function*(){const t=yield this.createIfNotExist();return t?JSON.parse(t.toString()):t}))}getCart(t){return o(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r=parseInt(t);return e.find((t=>t.id===r))}))}postCart(t){return o(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r={timestamp:(new Date).toString(),products:t};return e.length?r.id=e[e.length-1].id+1:r.id=1,e.push(r),yield this.fs.writeFile(this.config,JSON.stringify(e)),r}))}deleteCart({id:t}){return o(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r=parseInt(t),o=e.filter((t=>t.id!==r));this.fs.writeFile(this.config,JSON.stringify(o))}))}postProduct(t,e){return o(this,void 0,void 0,(function*(){const r=yield this.getCarts(),o=r.find((e=>e.id===t.id));return o?(o.products.push(e),yield this.fs.writeFile(this.config,JSON.stringify(r)),e=t.products.find((t=>t.id===e.id))):null}))}deleteProduct(t,e){return o(this,void 0,void 0,(function*(){const r=yield this.getCarts(),o=parseInt(e),i=r.find((e=>e.id===t.id));return!!i&&(i.products.filter((t=>t.id!==o)),this.fs.writeFile(this.config,JSON.stringify(r)),!0)}))}}e.default=s},792:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(627));class s extends n.default{constructor(t){super(t),this.connect(),this.db=this.admin.firestore(),this.query=this.db.collection("carts")}postCart(t){return o(this,void 0,void 0,(function*(){const e={timestamp:(new Date).toString(),products:[]};t&&!t.length?e.products.push(t):t.length&&(e.products=t);const r=this.query.doc(),o=r._path.segments[1];yield r.create(e);const i=yield this.getCart(o);if(i.products)return i}))}deleteCart(t){return o(this,void 0,void 0,(function*(){const e=this.query.doc(t.id);t.products&&(yield e.delete())}))}getCart(t){return o(this,void 0,void 0,(function*(){const e=yield this.query.doc(t),r=yield e.get(),o=Object.assign({id:e.id},r.data());if(o.title)return o}))}postProduct(t,e){return o(this,void 0,void 0,(function*(){const r=this.admin.firestore.FieldValue.arrayUnion,o=this.query.doc(t.id);return t.products?(yield o.update({products:r(e)}),e):e}))}deleteProduct(t,e){return o(this,void 0,void 0,(function*(){const r=this.query.doc(t.id);let o;if(t.products&&(o=t.products.find((t=>t.id===e))),o){const t=this.admin.firestore.FieldValue.arrayRemove;return yield r.update({products:t(o)}),o}return o}))}}e.default=s},303:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(135)),s=r(794),d=r(752);class u extends n.default{constructor(t){super(t),this.connect()}postCart(t){return o(this,void 0,void 0,(function*(){const e=new s.Cart;return yield e.save(((e,r)=>{e&&d.logger.error(e),r.products=t,r.save()})),e}))}deleteCart({id:t}){return o(this,void 0,void 0,(function*(){yield s.Cart.findByIdAndRemove(t)}))}getCart(t){return o(this,void 0,void 0,(function*(){return yield s.Cart.findById(t)}))}postProduct({id:t},e){return o(this,void 0,void 0,(function*(){let r;return yield s.Cart.findByIdAndUpdate(t,{$push:{products:e}},{new:!0}).then((t=>{t&&(r=t.products.find((t=>t._id==e._id)))})),r}))}deleteProduct({id:t},e){return o(this,void 0,void 0,(function*(){let r;return yield s.Cart.findByIdAndUpdate(t,{$pull:{products:{_id:e}}}).then((t=>{t&&(r=t.products.find((t=>t._id==e)))})),r}))}}e.default=u},526:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(231));class s extends n.default{constructor(t){super(t)}createIfNotExists(){return o(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts",(t=>{t.increments("id"),t.string("title"),t.timestamp("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}createIfNotExistsProducts(){return o(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts_products",(t=>{t.integer("id"),t.integer("cart_id"),t.string("title"),t.string("description"),t.string("thumbnail"),t.float("price"),t.integer("stock"),t.string("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}postCart(t){return o(this,void 0,void 0,(function*(){yield this.createIfNotExists(),yield this.createIfNotExistsProducts();const e=yield this.knex("carts").insert({title:"Carrito"});return t.forEach((t=>{t.cart_id=e[0]})),yield this.knex("carts_products").insert(t),this.getCart(e[0].toString())}))}deleteCart({id:t}){return o(this,void 0,void 0,(function*(){yield this.knex("carts_products").where("cart_id",t).del(),yield this.knex("carts").where("id",t).del()}))}getCart(t){return o(this,void 0,void 0,(function*(){try{const e=(yield this.knex.from("carts").select("*").where("id",t))[0];return e.products=yield this.knex.from("carts_products").select("*").where("cart_id",t),e}catch(t){return console.log(t.sqlMessage),!1}}))}postProduct(t,e){return o(this,void 0,void 0,(function*(){return t.products&&(e.cart_id=t.id),yield this.knex("carts_products").insert(e),e}))}deleteProduct(t,e){return o(this,void 0,void 0,(function*(){const r=yield this.knex.from("carts_products").select("*").where("id",e).andWhere("cart_id",t.id);return yield this.knex("carts_products").where("id",e).andWhere("cart_id",t.id).del(),r[0]}))}}e.default=s},971:function(t,e,r){var o=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,i)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&o(e,t,r);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.daoProducts=e.daoCarts=void 0,r(81);const s=r(913);let d,u;switch(e.daoCarts=d,e.daoProducts=u,process.env.DB){case"mariaSql":Promise.resolve().then((()=>n(r(526)))).then((({default:t})=>{e.daoCarts=d=new t(s.sqlite3)})),Promise.resolve().then((()=>n(r(470)))).then((({default:t})=>{e.daoProducts=u=new t(s.mariadb)}));break;case"mongoDb":Promise.resolve().then((()=>n(r(303)))).then((({default:t})=>{e.daoCarts=d=new t(s.mongoDbKey)})),Promise.resolve().then((()=>n(r(179)))).then((({default:t})=>{e.daoProducts=u=new t(s.mongoDbKey)}));break;case"firebase":Promise.resolve().then((()=>n(r(792)))).then((({default:t})=>{e.daoCarts=d=new t(s.serviceAccount)})),Promise.resolve().then((()=>n(r(593)))).then((({default:t})=>{e.daoProducts=u=new t(s.serviceAccount)}));break;default:Promise.resolve().then((()=>n(r(808)))).then((({default:t})=>{e.daoCarts=d=new t("carts.json")})),Promise.resolve().then((()=>n(r(722)))).then((({default:t})=>{e.daoProducts=u=new t("products.json")}))}},722:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(89));class s extends n.default{constructor(t){super(t)}getProducts(){return o(this,void 0,void 0,(function*(){const t=yield this.createIfNotExist();return t?JSON.parse(t.toString()):t}))}postProduct(t){return o(this,void 0,void 0,(function*(){const e=yield this.getProducts();return e.length?t.id=e[e.length-1].id+1:t.id=1,t.timestamp=(new Date).toString(),e.push(t),yield this.fs.writeFile(this.config,JSON.stringify(e)),t}))}getProduct(t){return o(this,void 0,void 0,(function*(){const e=parseInt(t);return(yield this.getProducts()).find((t=>t.id===e))}))}putProduct(t,e){return o(this,void 0,void 0,(function*(){const r=parseInt(t),o=(yield this.getProducts()).filter((t=>t.id!==r));return e.id=r,o.push(e),yield this.fs.writeFile(this.config,JSON.stringify(o)),e}))}deleteProduct({id:t}){return o(this,void 0,void 0,(function*(){const e=parseInt(t),r=(yield this.getProducts()).filter((t=>t.id!==e));this.fs.writeFile(this.config,JSON.stringify(r))}))}}e.default=s},593:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(627));class s extends n.default{constructor(t){super(t),this.db=this.admin.firestore(),this.query=this.db.collection("products")}getProducts(){return o(this,void 0,void 0,(function*(){return(yield this.query.get()).docs.map((t=>Object.assign({id:t.id},t.data())))}))}postProduct(t){return o(this,void 0,void 0,(function*(){t.timestamp=(new Date).toString();const e=this.query.doc(),r=e._path.segments[1];yield e.create(t);const o=yield this.getProduct(r);if(o.title)return o}))}getProduct(t){return o(this,void 0,void 0,(function*(){const e=this.query.doc(t),r=yield e.get(),o=Object.assign({id:e.id},r.data());if(o.title)return o}))}putProduct(t,e){return o(this,void 0,void 0,(function*(){const r=this.query.doc(t);yield r.update(e);const o=yield this.getProduct(t);if(o.title)return o}))}deleteProduct(t){return o(this,void 0,void 0,(function*(){const e=this.query.doc(t.id);return!!t.title&&(yield e.delete(),!0)}))}}e.default=s},470:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(231));class s extends n.default{constructor(t){super(t)}createIfNotExists(){return o(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("products",(t=>{t.increments("id"),t.string("title"),t.string("description"),t.string("thumbnail"),t.float("price"),t.integer("stock"),t.timestamp("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}getProducts(){return o(this,void 0,void 0,(function*(){return yield this.knex.from("products").select("*")}))}postProduct(t){return o(this,void 0,void 0,(function*(){yield this.createIfNotExists();const e=yield this.knex("products").insert(t);return yield this.getProduct(e[0].toString())}))}getProduct(t){return o(this,void 0,void 0,(function*(){return(yield this.knex.from("products").select("*").where("id",t))[0]}))}putProduct(t,e){return o(this,void 0,void 0,(function*(){return yield this.knex("products").where("id",t).update(e),yield this.getProduct(t)}))}deleteProduct({id:t}){return o(this,void 0,void 0,(function*(){yield this.knex("products").where("id",t).del()}))}}e.default=s},179:function(t,e,r){var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function s(t){try{u(o.next(t))}catch(t){n(t)}}function d(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,d)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(r(135)),s=r(489);class d extends n.default{constructor(t){super(t)}getProducts(){return o(this,void 0,void 0,(function*(){return yield s.Product.find({})}))}postProduct(t){return o(this,void 0,void 0,(function*(){const e=new s.Product(t);return yield e.save()}))}getProduct(t){return o(this,void 0,void 0,(function*(){return yield s.Product.findById(t)}))}putProduct(t,e){return o(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndUpdate(t,e)}))}deleteProduct({id:t}){return o(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndRemove(t)}))}}e.default=d},794:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Cart=void 0;const i=o(r(185)),n=r(489),s=new i.default.Schema({products:[n.productSchema],timestamp:{type:String,default:(new Date).toString()}});e.Cart=i.default.model("carts",s)},489:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Product=e.productSchema=void 0;const i=o(r(185));e.productSchema=new i.default.Schema({title:{type:String,required:!0},description:{type:String,required:!0},thumbnail:{type:String,required:!0},price:{type:Number,required:!0},timestamp:{type:String,default:(new Date).toString()},stock:{type:Number,required:!0}}),e.Product=i.default.model("products",e.productSchema)},12:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const o=r(185),i=new o.Schema({username:{type:String,required:!0},password:{type:String,required:!0}}),n=(0,o.model)("users",i);e.default=n},114:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(860),n=o(r(817)),s=(0,i.Router)();e.default=class{constructor(){this.router=s,this.cartsController=new n.default,s.use((0,i.json)()),s.use((0,i.urlencoded)({extended:!0})),s.post("/",this.cartsController.postCart),s.delete("/:id",this.cartsController.deleteCart),s.get("/:id/productos",this.cartsController.getCart),s.post("/:id/productos",this.cartsController.postProduct),s.delete("/:id/productos/:id_prod",this.cartsController.deleteProduct)}}},422:function(t,e,r){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(860),n=o(r(243)),s=o(r(802)),d=(0,i.Router)();e.default=class{constructor(){this.router=d,this.productsController=new n.default,d.use((0,i.json)()),d.use((0,i.urlencoded)({extended:!0})),d.get("/:id?",this.productsController.getProducts),d.post("/",s.default,this.productsController.postProduct),d.put("/:id",s.default,this.productsController.putProduct),d.delete("/:id",s.default,this.productsController.deleteProduct)}}},96:t=>{t.exports=require("bcrypt")},455:t=>{t.exports=require("compression")},81:t=>{t.exports=require("dotenv/config")},860:t=>{t.exports=require("express")},508:t=>{t.exports=require("express-session")},509:t=>{t.exports=require("firebase-admin")},514:t=>{t.exports=require("knex")},566:t=>{t.exports=require("minimist")},185:t=>{t.exports=require("mongoose")},511:t=>{t.exports=require("passport")},55:t=>{t.exports=require("passport-local")},773:t=>{t.exports=require("winston")},1:t=>{t.exports=require("cluster")},147:t=>{t.exports=require("fs")},37:t=>{t.exports=require("os")}},e={};!function r(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={exports:{}};return t[o].call(n.exports,n,n.exports,r),n.exports}(505)})();