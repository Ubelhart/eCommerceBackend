(()=>{"use strict";var t={5505:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(6752)),o=n(r(5001)),s=r(4274);if("CLUSTER"===s.mode._[0])if(o.default.isPrimary){console.log("Master cluster setting up");for(let t=0;t<s.numCPUs;t++)o.default.fork();o.default.on("exit",(t=>{console.log(`worker ${t.process.pid} died`)}))}else i.default.listen(s.PORT,(()=>{console.log(`Servidor corriendo en http://localhost:${s.PORT}`)})),console.log(`Worker ${process.pid} started`);else i.default.listen(s.PORT,(()=>{console.log(`Servidor corriendo en http://localhost:${s.PORT}`)}))},6752:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(1081);const i=n(r(3114)),o=n(r(6422)),s=n(r(7455)),u=n(r(6860)),d=n(r(6508)),c=n(r(6687)),a=n(r(3582)),l=(0,u.default)();l.use(u.default.static("public")),l.use(u.default.json()),l.use(u.default.urlencoded({extended:!0})),l.use((0,d.default)({secret:"secreto",cookie:{httpOnly:!1,secure:!1,maxAge:6e5},rolling:!0,resave:!0,saveUninitialized:!1})),l.use(c.default.initialize()),l.use(c.default.session()),l.use((0,s.default)()),l.use((0,a.default)()),l.use("/api/carrito",(new i.default).router),l.use("/api/productos",(new o.default).router),l.set("views","./views"),l.set("view engine","ejs"),e.default=l},8913:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.serviceAccount=e.sqlite3=e.mariadb=e.mongoDbKey=void 0,r(1081),e.mongoDbKey=process.env.MONGO||"mongodb://localhost:27017/ecommerce",e.mariadb={client:"mysql",connection:{host:"127.0.0.1",user:"root",password:"",database:"ecommerce"}},e.sqlite3={client:"sqlite3",connection:{filename:"./src/db/mydb.sqlite"},useNullAsDefault:!0},e.serviceAccount={type:process.env.FIREBASE_type,project_id:process.env.FIREBASE_project_id,private_key_id:process.env.FIREBASE_private_key_id,private_key:process.env.FIREBASE_private_key,client_email:process.env.FIREBASE_client_email,client_id:process.env.FIREBASE_client_id,auth_uri:process.env.FIREBASE_auth_uri,token_uri:process.env.FIREBASE_token_uri,auth_provider_x509_cert_url:process.env.FIREBASE_auth_provider_x509_cert_url,client_x509_cert_url:process.env.FIREBASE_client_x509_cert_url}},3089:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=r(7147);e.default=class{constructor(t){this.fileName=t,this.config=`./db/${t}`,this.fs=i.promises}createIfNotExist(){return n(this,void 0,void 0,(function*(){try{return yield i.promises.readFile(this.config)}catch(t){if("ENOENT"===t.code)return yield i.promises.writeFile(this.config,"[]").then((()=>{console.log(`No existe ${this.fileName}. Archivo creado.`)})),yield i.promises.readFile(this.config);console.log("Hubo un error",t)}return null}))}}},1179:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(2509));e.default=class{constructor(t){this.config=t,this.admin=i.default}connect(){i.default.initializeApp({credential:i.default.credential.cert(this.config)}),console.log("Firebase connected")}}},3231:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(514));e.default=class{constructor(t){this.knex=(0,i.default)(t)}}},135:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(1185));e.default=class{constructor(t){this.config=t}connect(){return n(this,void 0,void 0,(function*(){try{yield o.default.connect(this.config),console.log("MongoDB connected")}catch(t){console.log("MongoDB connection error",t)}}))}}},8318:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(1081);const o=r(8216),s=new(i(r(9066)).default);e.default=class{constructor(){this.postCart=this.postCart.bind(this),this.deleteCart=this.deleteCart.bind(this),this.getCart=this.getCart.bind(this),this.postProduct=this.postProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}postCart(t,e){return n(this,void 0,void 0,(function*(){if(t.user)try{const r=yield s.postCart(t.body,t.user);return r?(yield(0,o.sendWhatsappMessageToAdmin)(t.user.username),yield(0,o.sendWhatsappMessageToCustomer)(t.user.phoneNumber),e.json(`El carrito con el id:${r.id} ha sido agregado`)):e.json({error:"no se pudo agregar el carrito"})}catch(t){return e.status(500).json({error:t.message})}return e.json({error:"debes iniciar sesión para agregar al carrito"})}))}deleteCart(t,e){return n(this,void 0,void 0,(function*(){if(t.user)try{const r=yield s.deleteCart(t.params,t.user);return r?e.json(`El carrito con el id:${r.id} ha sido eliminado`):e.json({error:`el carrito con el id:${t.params.id} no existe`})}catch(t){return e.status(500).json({error:t.message})}return e.json({error:"debes iniciar sesión para eliminar el carrito"})}))}getCart(t,e){return n(this,void 0,void 0,(function*(){if(t.user)try{const r=yield s.deleteCart(t.params,t.user);return r?e.json(r):e.json({error:`el carrito con el id:${t.params.id} no existe`})}catch(t){return e.status(500).json({error:t.message})}return e.json({error:"debes iniciar sesión para ver el carrito"})}))}postProduct(t,e){return n(this,void 0,void 0,(function*(){if(t.user)try{const r=yield s.postProduct(t.params,t.body,t.user);return r?e.json(`El producto con el id:${r.id} ha sido agregado`):e.json({error:`el producto no pudo ser agregado al carrito con el id:${t.params.id}`})}catch(t){return e.status(500).json({error:t.message})}return e.json({error:"debes iniciar sesión para agregar un producto"})}))}deleteProduct(t,e){return n(this,void 0,void 0,(function*(){if(t.user)try{const r=yield s.deleteProduct(t.params,t.user);return r?e.json(`El producto con el id:${r.id} ha sido eliminado`):e.json({error:`el producto con el id:${t.params.id_prod} no existe en el carrito con el id:${t.params.id}`})}catch(t){return e.status(500).json({error:t.message})}return e.json({error:"debes iniciar sesión para eliminar un producto"})}))}}},3767:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(1081);const o=i(r(6645)),s=new(i(r(3153)).default);e.default=class{constructor(){this.getProduct=this.getProduct.bind(this),this.postProduct=this.postProduct.bind(this),this.putProduct=this.putProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}getProduct(t,e){return n(this,void 0,void 0,(function*(){try{const r=yield s.getProduct(t.params.id);return r?e.json(r):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return o.default.error(t.message),e.status(500).json({message:t.message})}}))}postProduct(t,e){return n(this,void 0,void 0,(function*(){try{const r=yield s.postProduct(t.body);return r?e.json(`El producto con el id:${r.id} ha sido creado`):e.json({error:"no se pudo crear el producto"})}catch(t){return o.default.error(t.message),e.status(500).json({message:t.message})}}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){try{const r=yield s.putProduct(t.params.id,t.body);return r?e.json(`El producto con el id:${r.id} ha sido actualizado`):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return o.default.error(t.message),e.status(500).json({message:t.message})}}))}deleteProduct(t,e){return n(this,void 0,void 0,(function*(){try{const r=yield s.deleteProduct(t.params.id);return r?e.json(`El producto con el id:${r.id} ha sido eliminado`):e.json({error:`el producto con el id:${t.params.id} no existe`})}catch(t){return o.default.error(t.message),e.status(500).json({message:t.message})}}))}}},4808:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(3089));class s extends o.default{constructor(t){super(t)}getCarts(){return n(this,void 0,void 0,(function*(){const t=yield this.createIfNotExist();return t?JSON.parse(t.toString()):t}))}getCart(t){return n(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r=parseInt(t);return e.find((t=>t.id===r))}))}postCart(t){return n(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r={timestamp:(new Date).toString(),products:t};return e.length?r.id=e[e.length-1].id+1:r.id=1,e.push(r),yield this.fs.writeFile(this.config,JSON.stringify(e)),r}))}deleteCart({id:t}){return n(this,void 0,void 0,(function*(){const e=yield this.getCarts(),r=parseInt(t),n=e.filter((t=>t.id!==r));this.fs.writeFile(this.config,JSON.stringify(n))}))}postProduct(t,e){return n(this,void 0,void 0,(function*(){const r=yield this.getCarts(),n=r.find((e=>e.id===t.id));return n?(n.products.push(e),yield this.fs.writeFile(this.config,JSON.stringify(r)),e=t.products.find((t=>t.id===e.id))):null}))}deleteProduct(t,e){return n(this,void 0,void 0,(function*(){const r=yield this.getCarts(),n=parseInt(e),i=r.find((e=>e.id===t.id));return!!i&&(i.products.filter((t=>t.id!==n)),this.fs.writeFile(this.config,JSON.stringify(r)),!0)}))}}e.default=s},3792:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(1179));class s extends o.default{constructor(t){super(t),this.connect(),this.db=this.admin.firestore(),this.query=this.db.collection("carts")}postCart(t){return n(this,void 0,void 0,(function*(){const e={timestamp:(new Date).toString(),products:[]};t&&!t.length?e.products.push(t):t.length&&(e.products=t);const r=this.query.doc(),n=r._path.segments[1];yield r.create(e);const i=yield this.getCart(n);if(i.products)return i}))}deleteCart(t){return n(this,void 0,void 0,(function*(){const e=this.query.doc(t.id);t.products&&(yield e.delete())}))}getCart(t){return n(this,void 0,void 0,(function*(){const e=yield this.query.doc(t),r=yield e.get(),n=Object.assign({id:e.id},r.data());if(n.title)return n}))}postProduct(t,e){return n(this,void 0,void 0,(function*(){const r=this.admin.firestore.FieldValue.arrayUnion,n=this.query.doc(t.id);return t.products?(yield n.update({products:r(e)}),e):e}))}deleteProduct(t,e){return n(this,void 0,void 0,(function*(){const r=this.query.doc(t.id);let n;if(t.products&&(n=t.products.find((t=>t.id===e))),n){const t=this.admin.firestore.FieldValue.arrayRemove;return yield r.update({products:t(n)}),n}return n}))}}e.default=s},9303:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(135)),s=r(5794);class u extends o.default{constructor(t){super(t),this.connect()}postCart(t){return n(this,void 0,void 0,(function*(){const e=new s.Cart;return yield e.save(t)}))}deleteCart(t,e){return n(this,void 0,void 0,(function*(){yield s.Cart.findOneAndDelete({_id:t,username:e})}))}getCart(t,{username:e}){return n(this,void 0,void 0,(function*(){return yield s.Cart.findOne({_id:t,username:e})}))}postProduct({id:t},e,{username:r}){return n(this,void 0,void 0,(function*(){return yield s.Cart.findOneAndUpdate({_id:t,username:r},{$push:{products:e}},{new:!0})}))}deleteProduct({id:t},e,{username:r}){return n(this,void 0,void 0,(function*(){return yield s.Cart.findOneAndUpdate({_id:t,username:r},{$pull:{products:{_id:e}}})}))}}e.default=u},5526:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(3231));class s extends o.default{constructor(t){super(t)}createIfNotExists(){return n(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts",(t=>{t.increments("id"),t.string("title"),t.timestamp("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}createIfNotExistsProducts(){return n(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts_products",(t=>{t.integer("id"),t.integer("cart_id"),t.string("title"),t.string("description"),t.string("thumbnail"),t.float("price"),t.integer("stock"),t.string("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}postCart(t){return n(this,void 0,void 0,(function*(){yield this.createIfNotExists(),yield this.createIfNotExistsProducts();const e=yield this.knex("carts").insert({title:"Carrito"});return t.forEach((t=>{t.cart_id=e[0]})),yield this.knex("carts_products").insert(t),this.getCart(e[0].toString())}))}deleteCart({id:t}){return n(this,void 0,void 0,(function*(){yield this.knex("carts_products").where("cart_id",t).del(),yield this.knex("carts").where("id",t).del()}))}getCart(t){return n(this,void 0,void 0,(function*(){try{const e=(yield this.knex.from("carts").select("*").where("id",t))[0];return e.products=yield this.knex.from("carts_products").select("*").where("cart_id",t),e}catch(t){return console.log(t.sqlMessage),!1}}))}postProduct(t,e){return n(this,void 0,void 0,(function*(){return t.products&&(e.cart_id=t.id),yield this.knex("carts_products").insert(e),e}))}deleteProduct(t,e){return n(this,void 0,void 0,(function*(){const r=yield this.knex.from("carts_products").select("*").where("id",e).andWhere("cart_id",t.id);return yield this.knex("carts_products").where("id",e).andWhere("cart_id",t.id).del(),r[0]}))}}e.default=s},5722:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(3089));class s extends o.default{constructor(t){super(t)}getProducts(){return n(this,void 0,void 0,(function*(){const t=yield this.createIfNotExist();return t?JSON.parse(t.toString()):t}))}postProduct(t){return n(this,void 0,void 0,(function*(){const e=yield this.getProducts();return e.length?t.id=e[e.length-1].id+1:t.id=1,t.timestamp=(new Date).toString(),e.push(t),yield this.fs.writeFile(this.config,JSON.stringify(e)),t}))}getProduct(t){return n(this,void 0,void 0,(function*(){const e=parseInt(t);return(yield this.getProducts()).find((t=>t.id===e))}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){const r=parseInt(t),n=(yield this.getProducts()).filter((t=>t.id!==r));return e.id=r,n.push(e),yield this.fs.writeFile(this.config,JSON.stringify(n)),e}))}deleteProduct({id:t}){return n(this,void 0,void 0,(function*(){const e=parseInt(t),r=(yield this.getProducts()).filter((t=>t.id!==e));this.fs.writeFile(this.config,JSON.stringify(r))}))}}e.default=s},1593:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(1179));class s extends o.default{constructor(t){super(t),this.db=this.admin.firestore(),this.query=this.db.collection("products")}getProducts(){return n(this,void 0,void 0,(function*(){return(yield this.query.get()).docs.map((t=>Object.assign({id:t.id},t.data())))}))}postProduct(t){return n(this,void 0,void 0,(function*(){t.timestamp=(new Date).toString();const e=this.query.doc(),r=e._path.segments[1];yield e.create(t);const n=yield this.getProduct(r);if(n.title)return n}))}getProduct(t){return n(this,void 0,void 0,(function*(){const e=this.query.doc(t),r=yield e.get(),n=Object.assign({id:e.id},r.data());if(n.title)return n}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){const r=this.query.doc(t);yield r.update(e);const n=yield this.getProduct(t);if(n.title)return n}))}deleteProduct(t){return n(this,void 0,void 0,(function*(){const e=this.query.doc(t.id);return!!t.title&&(yield e.delete(),!0)}))}}e.default=s},1470:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(3231));class s extends o.default{constructor(t){super(t)}createIfNotExists(){return n(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("products",(t=>{t.increments("id"),t.string("title"),t.string("description"),t.string("thumbnail"),t.float("price"),t.integer("stock"),t.timestamp("timestamp")}))}catch(t){console.log(t.sqlMessage)}}))}getProducts(){return n(this,void 0,void 0,(function*(){return yield this.knex.from("products").select("*")}))}postProduct(t){return n(this,void 0,void 0,(function*(){yield this.createIfNotExists();const e=yield this.knex("products").insert(t);return yield this.getProduct(e[0].toString())}))}getProduct(t){return n(this,void 0,void 0,(function*(){return(yield this.knex.from("products").select("*").where("id",t))[0]}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){return yield this.knex("products").where("id",t).update(e),yield this.getProduct(t)}))}deleteProduct({id:t}){return n(this,void 0,void 0,(function*(){yield this.knex("products").where("id",t).del()}))}}e.default=s},4179:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(135)),s=r(6489);class u extends o.default{constructor(t){super(t)}getProduct(t){return n(this,void 0,void 0,(function*(){return yield s.Product.findById(t)}))}getProducts(){return n(this,void 0,void 0,(function*(){return yield s.Product.find({})}))}postProduct(t){return n(this,void 0,void 0,(function*(){const e=new s.Product(t);return yield e.save()}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndUpdate(t,e)}))}deleteProduct(t){return n(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndRemove(t)}))}}e.default=u},9022:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const i=r(8913),o=n(r(4808)),s=n(r(5722)),u=n(r(3792)),d=n(r(1593)),c=n(r(9303)),a=n(r(4179)),l=n(r(5526)),f=n(r(1470));let h,p;class v{create(t,e){switch(t){case"mongoDb":switch(e){case"carts":h=new c.default(i.mongoDbKey);break;case"products":h=new a.default(i.mongoDbKey)}return h;case"firebase":switch(e){case"carts":h=new u.default(i.serviceAccount);break;case"products":h=new d.default(i.serviceAccount)}return h;case"mariaSql":switch(e){case"carts":h=new l.default(i.sqlite3);break;case"products":h=new f.default(i.mariadb)}return h;default:switch(e){case"carts":h=new o.default("carts.json");break;case"products":h=new s.default("products.json")}return h}}static getInstance(){return p||(p=new v),p}}e.Factory=v,e.default=v},5794:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Cart=void 0;const i=n(r(1185)),o=r(6489),s=new i.default.Schema({username:{type:String,require:!0},products:[o.productSchema],timestamp:{type:String,default:(new Date).toString()}});e.Cart=i.default.model("carts",s)},6489:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Product=e.productSchema=void 0;const i=n(r(1185));e.productSchema=new i.default.Schema({title:{type:String,required:!0},description:{type:String,required:!0},thumbnail:{type:String,required:!0},price:{type:Number,required:!0},timestamp:{type:String,default:(new Date).toString()},stock:{type:Number,required:!0}}),e.Product=i.default.model("products",e.productSchema)},7012:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=r(1185),i=new n.Schema({username:{type:String,required:!0},password:{type:String,required:!0},name:{type:String,required:!0},address:{type:String,required:!0},age:{type:Number,required:!0},phoneNumber:{type:String,required:!0},avatar:{type:String,required:!0}}),o=(0,n.model)("users",i);e.default=o},9123:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(1081);const o=i(r(9022)).default.getInstance().create(process.env.DB,"carts");e.default=class{postCart(t){return n(this,void 0,void 0,(function*(){return yield o.postCart(t)}))}deleteCart(t,e){return n(this,void 0,void 0,(function*(){return yield o.deleteCart(t,e)}))}getCart(t,e){return n(this,void 0,void 0,(function*(){return yield o.getCart(t,e)}))}postProduct(t,e,r){return n(this,void 0,void 0,(function*(){return(yield o.postProduct(t,e,r)).products.find((t=>t._id==e._id))}))}deleteProduct(t,e,r){return n(this,void 0,void 0,(function*(){return(yield o.deleteProduct(t,e,r)).products.find((t=>t._id==e))}))}}},546:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),r(1081);const o=i(r(9022)).default.getInstance().create(process.env.DB,"products");e.default=class{constructor(){}getProduct(t){return n(this,void 0,void 0,(function*(){return t?yield o.getProduct(t):yield o.getProducts()}))}postProduct(t){return n(this,void 0,void 0,(function*(){return yield o.postProduct(t)}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){return yield o.putProduct(t,e)}))}deleteProduct(t){return n(this,void 0,void 0,(function*(){return yield o.deleteProduct(t)}))}}},8114:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(6752)),o=n(r(6687)),s=n(r(6645));i.default.get("/register",((t,e)=>{e.render("register")})),i.default.post("/register",o.default.authenticate("signup",{successRedirect:"/login",failureRedirect:"/failregister"})),i.default.get("/failregister",((t,e)=>{s.default.info("Fallo al registrar usuario"),e.render("failregister")})),i.default.get("/login",((t,e)=>{e.render("login")})),i.default.post("/login",o.default.authenticate("login",{successRedirect:"/",failureRedirect:"/faillogin"})),i.default.get("/faillogin",((t,e)=>{s.default.info("Fallo al iniciar sesión"),e.render("faillogin")})),i.default.get("/logout",((t,e)=>{if(t.user){const{username:r}=t.user;return t.logOut((t=>t?(s.default.error(t),e.redirect("/login")):e.render("logout",{username:r})))}e.redirect("/login")})),e.default=i.default},3114:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(6860),o=n(r(8318)),s=(0,i.Router)();e.default=class{constructor(){this.router=s,this.cartsController=new o.default,s.use((0,i.json)()),s.use((0,i.urlencoded)({extended:!0})),s.post("/",this.cartsController.postCart),s.delete("/:id",this.cartsController.deleteCart),s.get("/:id/productos",this.cartsController.getCart),s.post("/:id/productos",this.cartsController.postProduct),s.delete("/:id/productos/:id_prod",this.cartsController.deleteProduct)}}},6422:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(6860),o=n(r(3767)),s=(0,i.Router)();e.default=class{constructor(){this.router=s,this.productsController=new o.default,s.use((0,i.json)()),s.use((0,i.urlencoded)({extended:!0})),s.get("/:id?",this.productsController.getProduct),s.post("/",this.productsController.postProduct),s.put("/:id",this.productsController.putProduct),s.delete("/:id",this.productsController.deleteProduct)}}},4274:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PORT=e.mode=e.numCPUs=void 0;const i=n(r(1566)),o=n(r(2037)),s=n(r(8114)),u=n(r(6645));e.numCPUs=o.default.cpus().length;const d=(0,i.default)(process.argv.slice(2));e.mode=(0,i.default)(process.argv.slice(3)),e.PORT=process.env.PORT||d._[0]||8080,s.default.get("/",((t,e)=>t.user?e.json(t.user):e.redirect("/login"))),s.default.get("/api/randoms",((t,e)=>{const{cant:r}=t.query,n=Number(r)||1e5,i=[];for(let t=0;t<n;t++)i.push(Math.floor(1e3*Math.random()));e.json(i)}));const c={"Argumentos de entrada":process.argv,"Nombre de la plataforma: ":process.platform,"Versión de Node: ":process.version,"Memoria total reservada":process.memoryUsage().heapTotal,"Path de ejecución":process.execPath,"Process id":process.pid,"Número de procesadores presentes en el servidor":"CLUSTER"===e.mode._[0]?e.numCPUs:1,"Carpeta del proyecto":__dirname,Port:e.PORT};s.default.get("/info",((t,e)=>{e.json(c)})),s.default.get("*",((t,e)=>{u.default.warn("Ruta no existente"),e.send("Ruta no existente")}))},9066:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=new(i(r(9123)).default);e.default=class{postCart(t,{username:e}){return n(this,void 0,void 0,(function*(){const r={username:e,products:t};return yield o.postCart(r)}))}deleteCart({id:t},{username:e}){return n(this,void 0,void 0,(function*(){const r=yield this.getCart(t,e);if(r)return yield o.deleteCart(t,e),r}))}getCart({id:t},{username:e}){return n(this,void 0,void 0,(function*(){return yield o.getCart(t,e)}))}postProduct({id:t},e,{username:r}){return n(this,void 0,void 0,(function*(){if(yield this.getCart(t,r))return yield o.postProduct(e,t,r)}))}deleteProduct({id:t,id_prod:e},{username:r}){return n(this,void 0,void 0,(function*(){if(yield this.getCart(t,r))return yield o.deleteProduct(t,e,r)}))}}},3153:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=new(i(r(546)).default);e.default=class{getProduct(t){return n(this,void 0,void 0,(function*(){return t?yield o.getProduct(t):yield o.getProduct(null)}))}postProduct(t){return n(this,void 0,void 0,(function*(){return yield o.postProduct(t)}))}putProduct(t,e){return n(this,void 0,void 0,(function*(){return yield o.putProduct(t,e)}))}deleteProduct(t){return n(this,void 0,void 0,(function*(){return yield o.deleteProduct(t)}))}}},6645:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(7773)),o=i.default.createLogger({transports:[new i.default.transports.Console({level:"info"}),new i.default.transports.File({filename:"warn.log",level:"warn"}),new i.default.transports.File({filename:"error.log",level:"error"})]});e.default=o},2918:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(5184),s=i(r(6645)),u=(0,o.createTransport)({service:"gmail",auth:{user:process.env.MAIL,pass:process.env.MAIL_PASSWORD}});e.default=function(t){return n(this,void 0,void 0,(function*(){const e=yield u.sendMail({from:"Servidor de Tienda",port:587,to:process.env.MAIL,subject:"Nuevo registro",html:`<h1>${t}</h1>`});s.default.info(e)}))}},6687:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(r(3511)),s=r(7055),u=i(r(7096)),d=i(r(7012)),c=i(r(6645)),a=i(r(2918));function l(t){return u.default.hashSync(t,u.default.genSaltSync(10),null)}o.default.use("login",new s.Strategy(((t,e,r)=>{d.default.findOne({username:t},((t,n)=>t?r(t):n?function(t,e){return u.default.compareSync(e,t.password)}(n,e)?r(null,n):(c.default.info("Contraseña incorrecta"),r(null,!1)):(c.default.info("Email no encontrado"),r(null,!1))))}))),o.default.use("signup",new s.Strategy({passReqToCallback:!0},(({body:t},e,r,i)=>{d.default.findOne({username:e},((o,s)=>{if(o)return i(o);if(s)return c.default.info("Email ya existe"),i(null,!1);const u=new d.default({username:e,password:l(r),name:t.name,address:t.address,age:t.age,phoneNumber:t.phoneNumber,avatar:t.avatar});u.save((t=>n(void 0,void 0,void 0,(function*(){return t?i(t):(yield(0,a.default)(u),i(null,u))}))))}))}))),o.default.serializeUser((({_id:t},e)=>{e(null,t)})),o.default.deserializeUser(((t,e)=>{d.default.findById(t,((t,r)=>t?e(t):e(null,r)))})),e.default=o.default},8216:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{d(n.next(t))}catch(t){o(t)}}function u(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,u)}d((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.sendWhatsappMessageToCustomer=e.sendWhatsappMessageToAdmin=void 0;const o=i(r(7202)),s=i(r(6645)),u=process.env.TWILIO_ACCOUNT_SID,d=process.env.TWILIO_AUTH_TOKEN,c=(0,o.default)(u,d);e.sendWhatsappMessageToAdmin=t=>n(void 0,void 0,void 0,(function*(){try{const e=yield c.messages.create({body:`Nuevo pedido de ${t}!`,from:`whatsapp:${process.env.TWILIO_NUMBER}`,to:`whatsapp:${process.env.MY_PHONE}`});s.default.info(e)}catch(t){s.default.error(t)}})),e.sendWhatsappMessageToCustomer=t=>n(void 0,void 0,void 0,(function*(){try{const e=yield c.messages.create({body:"Su pedido ha sido recibido y se encuentra en proceso!",from:`whatsapp:${process.env.TWILIO_NUMBER}`,to:`whatsapp:${t}`});s.default.info(e)}catch(t){s.default.error(t)}}))},7096:t=>{t.exports=require("bcrypt")},7455:t=>{t.exports=require("compression")},3582:t=>{t.exports=require("cors")},1081:t=>{t.exports=require("dotenv/config")},6860:t=>{t.exports=require("express")},6508:t=>{t.exports=require("express-session")},2509:t=>{t.exports=require("firebase-admin")},514:t=>{t.exports=require("knex")},1566:t=>{t.exports=require("minimist")},1185:t=>{t.exports=require("mongoose")},5184:t=>{t.exports=require("nodemailer")},3511:t=>{t.exports=require("passport")},7055:t=>{t.exports=require("passport-local")},7202:t=>{t.exports=require("twilio")},7773:t=>{t.exports=require("winston")},5001:t=>{t.exports=require("cluster")},7147:t=>{t.exports=require("fs")},2037:t=>{t.exports=require("os")}},e={};!function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(5505)})();