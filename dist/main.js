(()=>{"use strict";var t={505:function(t,e,o){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(o(752)),i=process.env.PORT||8080;n.default.listen(i,(()=>{console.log(`Servidor corriendo en http://localhost:${i}`)}))},752:function(t,e,o){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(o(860)),i=o(971),s=(0,n.default)();s.use("/api/carrito",i.firebaseDaoCarts.router),s.use("/api/productos",i.firebaseDaoProducts.router),e.default=s},802:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,o){"true"===t.headers.admin?o():e.status(401).json({error:"No autorizado"})}},179:function(t,e,o){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(o(509));e.default=class{constructor(t){this.config=t,this.admin=n.default}connect(){n.default.initializeApp({credential:n.default.credential.cert(this.config)}),console.log("Firebase connected")}}},792:function(t,e,o){var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function d(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(860),s=n(o(179)),d=(0,i.Router)();class c extends s.default{constructor(t){super(t),d.use((0,i.json)()),d.use((0,i.urlencoded)({extended:!0})),this.connect(),this.db=this.admin.firestore(),this.query=this.db.collection("carts"),this.postCart(),this.deleteCart(),this.getCart(),this.deleteProduct(),this.router=d}postCart(){d.route("/").post(((t,e)=>r(this,void 0,void 0,(function*(){try{const o={timestamp:(new Date).toString(),products:[]};t.body&&!t.body.length?o.products.push(t.body):t.body.length&&(o.products=t.body);const r=this.query.doc(),n=r._path.segments[1];yield r.create(o),e.json(`El carrito con el id:${n} ha sido insertado`)}catch(t){console.log(t),e.json({error:"no se pudo insertar carrito"})}}))))}deleteCart(){d.route("/:id").delete(((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.query.doc(t.params.id),r=yield o.get(),n=Object.assign({id:o.id},r.data());try{if(n.products)return yield o.delete(),e.json(`El carrito con el id:${t.params.id} ha sido eliminado`);e.json({error:"carrito no encontrado"})}catch(t){console.log(t)}}catch(t){console.log(t)}}))))}getCart(){d.route("/:id/productos").get(((t,e)=>r(this,void 0,void 0,(function*(){try{const o=yield this.query.doc(t.params.id),r=yield o.get(),n=Object.assign({id:o.id},r.data());if(!n.products)return e.json({error:"carrito no encontrado"});if(n.products.length)return e.json(n);e.json("El carrito esta vació")}catch(t){console.log(t)}})))).post(((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.admin.firestore.FieldValue.arrayUnion,r=this.query.doc(t.params.id),n=yield r.get(),i=Object.assign({id:r.id},n.data());try{if(i.products)return yield r.update({products:o(t.body)}),e.json("Producto insertado con éxito");e.json({error:"carrito no encontrado"})}catch(t){console.log(t)}}catch(t){console.log(t)}}))))}deleteProduct(){d.route("/:id/productos/:id_prod").delete(((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.query.doc(t.params.id),r=yield o.get(),n=Object.assign({id:o.id},r.data());let i;n.products&&(i=n.products.find((e=>e.id===t.params.id_prod)));try{if(i){const r=this.admin.firestore.FieldValue.arrayRemove;return yield o.update({products:r(i)}),e.json(`El producto con el id:${t.params.id_prod} ha sido eliminado del carrito con el id:${t.params.id}`)}if(n.products)return e.json(`El producto con el id:${t.params.id_prod} no existe en el carrito con el id:${t.params.id}`);e.json({error:"carrito no encontrado"})}catch(t){console.log(t)}}catch(t){console.log(t)}}))))}}e.default=c},971:function(t,e,o){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.firebaseDaoProducts=e.firebaseDaoCarts=void 0;const n=r(o(792)),i=r(o(593)),s=r(o(351));e.firebaseDaoCarts=new n.default(s.default),e.firebaseDaoProducts=new i.default(s.default)},593:function(t,e,o){var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function d(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(860),s=n(o(179)),d=n(o(802)),c=(0,i.Router)();class a extends s.default{constructor(t){super(t),c.use((0,i.json)()),c.use((0,i.urlencoded)({extended:!0})),this.db=this.admin.firestore(),this.query=this.db.collection("products"),this.getProducts(),this.getProduct(),this.router=c}getProducts(){c.route("/").get(((t,e)=>r(this,void 0,void 0,(function*(){try{const t=(yield this.query.get()).docs.map((t=>Object.assign({id:t.id},t.data())));if(t.length)return e.json(t);e.json({error:"no se encontraron productos"})}catch(t){console.log(t)}})))).post(d.default,((t,e)=>r(this,void 0,void 0,(function*(){try{t.body.timestamp=(new Date).toString();const o=this.query.doc(),r=o._path.segments[1];yield o.create(t.body),e.json(`El producto con el id:${r} ha sido insertado`)}catch(t){console.log(t),e.json({error:"no se pudo insertar producto"})}}))))}getProduct(){c.route("/:id").get(((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.query.doc(t.params.id),r=yield o.get(),n=Object.assign({id:o.id},r.data());if(n.title)return e.json(n);e.json({error:"producto no encontrado"})}catch(t){console.log(t)}})))).put(d.default,((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.query.doc(t.params.id);return yield o.update(t.body),e.json(`El producto con el id:${t.params.id} ha sido actualizado`)}catch(t){console.log(t),e.json({error:"producto no encontrado"})}})))).delete(d.default,((t,e)=>r(this,void 0,void 0,(function*(){try{const o=this.query.doc(t.params.id);yield o.delete(),e.json(`El producto con el id:${t.params.id} ha sido eliminado`)}catch(t){console.log(t),e.json({error:"producto no encontrado"})}}))))}}e.default=a},860:t=>{t.exports=require("express")},509:t=>{t.exports=require("firebase-admin")},351:t=>{t.exports=JSON.parse('{"type":"service_account","project_id":"backendecommerce-dec6c","private_key_id":"aef48c2fd1f66e64f17a9a8143a5714f941a35fa","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCytu4K9Otec6Vj\\nMzrEnSCUP1Sbqa90up+uHbSp9Z/9Vd/e8YYVdiJqVzpy+R98UPz5rssfWigOHaHi\\n6kzm8a4OOlFXQdJ+57TBf1A8ZnSL9wZ3RVDYGk44hqa6xjlfD62tUC4mrrMWb/dA\\nEOZUM3RACE1xZ+g26xfvwMo5aJbRdtawJ1m0KfeR2bBiIZVqmm4aa8uJOCkdoLfU\\nBRNBhxPa/qgLKcYeJHF2OC3gCiW1875YFPiolNCBl9EzWZf/Nfb49aw5/VybKXg9\\nA61kwxKzwY0ctOBDxDnRFPppKQ7ZC+vH8s9COLNH+ns/UUgOubH08VsVDp9//6kh\\nAZHnjIRLAgMBAAECggEAAoL9hXfEQ98H8mtd5nnEMEAgaElBKTiv1dQ4P+1iNfqa\\nMLusyFj3n6gMUS4liyLNlgw36UQXYEpYMOjDrx+ABWdvnknKzSdkgVoU+lVnW8nS\\n2sYBSSHVg1TLzK7dk9GC/cOCL1bbnXwLwlcC/0riXk6uf2sgkFx+jVxTe0KJT0uA\\nYMR6j5P3gUvXLqjkTtxGlhfXYOK3GqF0Kf2JyzsZGL/0xLN7CY8gDZ7ejkh3I6Qz\\n3DUIDk5RrzWWkusF4xsup7JWH55nxdnpU/FIl4ZLC9OEN3vQFiGYL2yLo0WN02mQ\\n0OMbj1Pi6UF2oYY3rY831xtWUb/9YQR0iPDdc5dtQQKBgQDn3TG0zQXbiO9FbHkq\\nBU8Rgh5GjWMQVXG/CHYtHPPW3gc7Js9j0Q6D8/NNHhlnP6buDXgg2UEXVQhyBZpo\\nwCT6/25kPKVmi05Tufvaq8yVTXjLyp1wMWsENgDnShAKwhSeNjlLEkymwu8UnAwH\\n0orfKV32Le648ylVyNyAtHsdXQKBgQDFUWMnQkT5z/QRePj5nvGAGwmXA7MndCDH\\nqW+bhAMjT9VHuZetY5vthiBKDc/Ps6EmJzvAM9YsAErDPn+EQnmXtah/oHntd5iq\\nXuB3e3WNj5ikLJSEupJNfB3lhCiSbBK8p+go8HvOdnzU1agV0/wb5Tn7uaReCxFD\\nBWlntx9lxwKBgQCRyWOykeLn+X6wwRaiFDp2AMF2jPnH0GG3wuNDVFwBMxOK3skx\\nssYUs7O8PnusjrowHen1hYTG3eF0iA9hY8ccxrSrc/JvupGiVWOFR9ZX3iFgyeIa\\nJAhs2mPRCaFykjuSiveVO0lU5WacJ83ssTY+QO1il9jtE39e/++dQV3TxQKBgDqu\\nI5CvUpgAUhNIKLMDo8p3P/jbLtJS5NS7/OcA8XX07fawqPz1nI+czcl4Jg8c2pXg\\nIRLd15mqVJGP6phItKR7b6rU7K3EXXB9Wr/txV3eEITyhRCb85p7iOCS1wYEgeX9\\nATv7mLYj4qfhCmXDbzxUhVPpN4qIPA/0cg5YFUxNAoGADyLgrXEozVBIUUqsXwKc\\nzZwEDipHy+27GdY3fNqig//YdK/C8aw9hdNyiuQP4YGp9D1gtLdOK2WfxSvdx40n\\nwyJpEp+eiQIg/2Z/TYYfmqHsFR1YjiyO6MKsM/bBLSV4r64gZmkmc9QUFapklNBp\\nobFq9PEEZcIGB4JViUB2Tcs=\\n-----END PRIVATE KEY-----\\n","client_email":"firebase-adminsdk-hm6xm@backendecommerce-dec6c.iam.gserviceaccount.com","client_id":"111270348000462068536","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-hm6xm%40backendecommerce-dec6c.iam.gserviceaccount.com"}')}},e={};!function o(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,o),i.exports}(505)})();