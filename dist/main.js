(()=>{"use strict";var t={505:function(t,r,e){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const s=o(e(752)),i=process.env.PORT||8080;s.default.listen(i,(()=>{console.log(`Servidor corriendo en http://localhost:${i}`)}))},771:function(t,r,e){var o=this&&this.__awaiter||function(t,r,e,o){return new(e||(e=Promise))((function(s,i){function n(t){try{a(o.next(t))}catch(t){i(t)}}function d(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var r;t.done?s(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(n,d)}a((o=o.apply(t,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});const s=e(860),i=e(147),n=(0,s.Router)();r.default=class{constructor(){this.carts=[],n.use((0,s.json)()),n.use((0,s.urlencoded)({extended:!0})),this.postCart(),this.deleteCart(),this.getCart(),this.deleteProduct(),this.router=n}createIfNotExist(){return o(this,void 0,void 0,(function*(){let t;try{t=yield i.promises.readFile("./carts.txt")}catch(r){"ENOENT"===r.code?(yield i.promises.writeFile("./carts.txt","[]").then((()=>{console.log("No existe carts.txt. Archivo creado.")})),t=yield i.promises.readFile("./carts.txt")):console.log("Hubo un error",r)}return t}))}postCart(){n.route("/").post(((t,r)=>{const e={timestamp:(new Date).toISOString(),product:t.body};this.createIfNotExist().then((t=>{if(this.carts=JSON.parse(t.toString()),!this.carts.length)return e.id=1;e.id=this.carts.at(-1).id+1})).finally((()=>{this.carts.push(e),i.promises.writeFile("./carts.txt",JSON.stringify(this.carts)),r.json(`El carrito con el id:${e.id} ha sido agregado`)}))}))}deleteCart(){n.route("/:id").delete(((t,r)=>{const e=parseInt(t.params.id);let o;this.createIfNotExist().then((t=>{this.carts=JSON.parse(t.toString()),o=this.carts.find((t=>t.id===e))})).finally((()=>{if(o)return this.carts=this.carts.filter((t=>t.id!==e)),i.promises.writeFile("./carts.txt",JSON.stringify(this.carts)),r.json(`El carrito con el id:${t.params.id} ha sido eliminado`);r.json({error:"carrito no encontrado"})}))}))}getCart(){n.route("/:id/productos").get(((t,r)=>{const e=parseInt(t.params.id),o=this.carts.find((t=>t.id===e));if(o)return r.json(o);r.json({error:"carrito no encontrado"})})).post(((t,r)=>{const e=parseInt(t.params.id);let o;this.createIfNotExist().then((t=>{this.carts=JSON.parse(t.toString()),o=this.carts.find((t=>t.id===e))})).finally((()=>{if(o)return o.products.push(t.body),i.promises.writeFile("./carts.txt",JSON.stringify(this.carts)),r.json(o);r.json({error:"carrito no encontrado"})}))}))}deleteProduct(){n.route("/:id/productos/:id_prod").delete(((t,r)=>{const e=parseInt(t.params.id),o=parseInt(t.params.id_prod);let s;this.createIfNotExist().then((t=>{this.carts=JSON.parse(t.toString()),s=this.carts.find((t=>t.id===e&&t.products))})).finally((()=>{if(s)return s.products.find((t=>t.id===o))?(s.products=s.products.filter((t=>t.id!==o)),i.promises.writeFile("./carts.txt",JSON.stringify(this.carts)),r.json(`El producto con el id:${o} ha sido eliminado`)):r.json({error:"producto no encontrado"});r.json({error:"carrito no encontrado"})}))}))}}},759:function(t,r,e){var o=this&&this.__awaiter||function(t,r,e,o){return new(e||(e=Promise))((function(s,i){function n(t){try{a(o.next(t))}catch(t){i(t)}}function d(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var r;t.done?s(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(n,d)}a((o=o.apply(t,r||[])).next())}))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const i=e(860),n=e(147),d=s(e(802)),a=(0,i.Router)();r.default=class{constructor(){this.products=[],a.use((0,i.json)()),a.use((0,i.urlencoded)({extended:!0})),this.getProducts(),this.getProduct(),this.router=a}createIfNotExist(){return o(this,void 0,void 0,(function*(){let t;try{t=yield n.promises.readFile("./products.txt")}catch(t){if("ENOENT"===t.code)return yield n.promises.writeFile("./products.txt","[]").then((()=>{console.log("No existe products.txt. Archivo creado.")})),yield n.promises.readFile("./products.txt");console.log("Hubo un error",t)}return t}))}getProducts(){a.route("/").get(((t,r)=>{this.createIfNotExist().then((t=>{this.products=JSON.parse(t.toString())})).finally((()=>{r.json(this.products)}))})).post(d.default,((t,r)=>{const e=t.body;this.createIfNotExist().then((t=>{if(this.products=JSON.parse(t.toString()),!this.products.length)return e.id=1;e.id=this.products.at(-1).id+1})).finally((()=>{e.timestamp=(new Date).toISOString(),this.products.push(e),n.promises.writeFile("./products.txt",JSON.stringify(this.products)),r.json(this.products)}))}))}getProduct(){a.route("/:id").get(((t,r)=>{const e=parseInt(t.params.id);let o;t.query.admin,this.createIfNotExist().then((t=>{this.products=JSON.parse(t.toString()),o=this.products.find((t=>t.id===e))})).finally((()=>{if(o)return r.json(o);r.json({error:"producto no encontrado"})}))})).put(d.default,((t,r)=>{const e=parseInt(t.params.id);let o;this.createIfNotExist().then((t=>{this.products=JSON.parse(t.toString()),o=this.products.find((t=>t.id===e))})).finally((()=>{if(o)return this.products=this.products.filter((t=>t.id!==e)),t.body.id=e,this.products.push(t.body),n.promises.writeFile("./products.txt",JSON.stringify(this.products)),r.json(`El producto con el id:${t.params.id} ha sido actualizado`);r.json({error:"producto no encontrado"})}))})).delete(d.default,((t,r)=>{const e=parseInt(t.params.id);let o;this.createIfNotExist().then((t=>{this.products=JSON.parse(t.toString()),o=this.products.find((t=>t.id===e))})).finally((()=>{if(o)return this.products=this.products.filter((t=>t.id!==e)),n.promises.writeFile("./products.txt",JSON.stringify(this.products)),r.json(`El producto con el id:${t.params.id} ha sido eliminado`);r.json({error:"producto no encontrado"})}))}))}}},752:function(t,r,e){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const s=o(e(860)),i=o(e(759)),n=o(e(771)),d=(0,s.default)(),a=new i.default,c=new n.default;d.use("/api/productos",a.router),d.use("/api/carrito",c.router),r.default=d},802:(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t,r,e){"true"===t.headers.admin?e():r.status(401).json({error:"No autorizado"})}},860:t=>{t.exports=require("express")},147:t=>{t.exports=require("fs")}},r={};!function e(o){var s=r[o];if(void 0!==s)return s.exports;var i=r[o]={exports:{}};return t[o].call(i.exports,i,i.exports,e),i.exports}(505)})();