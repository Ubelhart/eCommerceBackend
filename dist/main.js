(()=>{"use strict";var e={505:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(o(752)),d=process.env.PORT||8080;n.default.listen(d,(()=>{console.log(`Servidor corriendo en http://localhost:${d}`)}))},752:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(o(860)),d=o(971),i=(0,n.default)();i.use("/api/carrito",d.mongoDbDaoCarts.router),i.use("/api/productos",d.mongoDbDaoProducts.router),t.default=i},802:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){"true"===e.headers.admin?o():t.status(401).json({error:"No autorizado"})}},913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mongoDbKey=void 0,t.mongoDbKey="mongodb+srv://juanpablo:020694@cluster0.qspzf.mongodb.net/ecommerce?retryWrites=true&w=majority"},135:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function i(e){try{a(r.next(e))}catch(e){d(e)}}function u(e){try{a(r.throw(e))}catch(e){d(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=n(o(185));t.default=class{constructor(e){this.config=e}connect(){return r(this,void 0,void 0,(function*(){try{yield d.default.connect(this.config),console.log("MongoDB connected")}catch(e){console.log("MongoDB connection error",e)}}))}}},303:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function i(e){try{a(r.next(e))}catch(e){d(e)}}function u(e){try{a(r.throw(e))}catch(e){d(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=o(860),i=n(o(135)),u=o(794),a=(0,d.Router)();class s extends i.default{constructor(e){super(e),a.use((0,d.json)()),a.use((0,d.urlencoded)({extended:!0})),this.connect(),this.postCart(),this.deleteCart(),this.getCart(),this.deleteProduct(),this.router=a}postCart(){a.route("/").post(((e,t)=>r(this,void 0,void 0,(function*(){const o=new u.Cart;yield o.save(((o,r)=>{if(o)console.log("Error al crear el carrito",o);else if(0===Object.keys(e.body).length)return t.json({error:"no puedes crear un carrito vaciÃ³"});r.products=e.body,r.save(),t.json(`El carrito con el id:${r._id} ha sido creado`)}))}))))}deleteCart(){a.route("/:id").delete(((e,t)=>{u.Cart.findByIdAndRemove(e.params.id,((o,r)=>{if(r)return t.json(`El carrito con el id:${e.params.id} ha sido eliminado`);o&&console.log("Error al eliminar el carrito",o),t.json({error:"carrito no encontrado"})}))}))}getCart(){a.route("/:id/productos").get(((e,t)=>{u.Cart.findById(e.params.id,((e,o)=>{if(e)return console.log(e),t.json({error:"carrito no encontrado"});t.json(o.products)}))})).post(((e,t)=>{u.Cart.findById(e.params.id,((o,r)=>{if(o)return console.log(o),t.json({error:"carrito no encontrado"});r.products.push(e.body),r.save(),t.json(r.products)}))}))}deleteProduct(){a.route("/:id/productos/:id_prod").delete(((e,t)=>{u.Cart.findByIdAndUpdate(e.params.id,{$pull:{products:{_id:e.params.id_prod}}},((o,r)=>o?(console.log(o),t.json({error:"carrito no encontrado"})):r.products.find((t=>t._id==e.params.id_prod))?t.json(`El producto con el id:${e.params.id_prod} ha sido eliminado del carrito con el id:${e.params.id}`):void t.json(`El producto con el id:${e.params.id_prod} no existe en el carrito con el id:${e.params.id}`)))}))}}t.default=s},971:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mongoDbDaoProducts=t.mongoDbDaoCarts=void 0;const n=r(o(303)),d=r(o(179)),i=o(913);t.mongoDbDaoCarts=new n.default(i.mongoDbKey),t.mongoDbDaoProducts=new d.default(i.mongoDbKey)},179:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function i(e){try{a(r.next(e))}catch(e){d(e)}}function u(e){try{a(r.throw(e))}catch(e){d(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=o(860),i=n(o(135)),u=o(489),a=n(o(802)),s=(0,d.Router)();class c extends i.default{constructor(e){super(e),s.use((0,d.json)()),s.use((0,d.urlencoded)({extended:!0})),this.getProducts(),this.getProduct(),this.router=s}getProducts(){s.route("/").get(((e,t)=>{u.Product.find({},((e,o)=>{e&&t.send(e),t.json(o)}))})).post(a.default,((e,t)=>r(this,void 0,void 0,(function*(){const o=new u.Product(e.body);yield o.save(),t.json(o)}))))}getProduct(){s.route("/:id").get(((e,t)=>{u.Product.findById(e.params.id,((e,o)=>{if(e)return t.json({error:"producto no encontrado"});t.json(o)}))})).put(a.default,((e,t)=>{u.Product.findByIdAndUpdate(e.params.id,e.body,(o=>{if(o)return t.json({error:"producto no encontrado"});t.json(`El producto con el id:${e.params.id} ha sido actualizado`)}))})).delete(a.default,((e,t)=>{u.Product.findByIdAndRemove(e.params.id,((o,r)=>{if(r)return t.json(`El producto con el id:${e.params.id} ha sido eliminado`);t.json({error:"producto no encontrado"})}))}))}}t.default=c},794:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cart=void 0;const n=r(o(185)),d=o(489),i=new n.default.Schema({products:[d.productSchema],timestamp:{type:Date,default:Date.now}});t.Cart=n.default.model("carts",i)},489:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.productSchema=void 0;const n=r(o(185));t.productSchema=new n.default.Schema({title:{type:String,required:!0},description:{type:String,required:!0},thumbnail:{type:String,required:!0},price:{type:Number,required:!0},timestamp:{type:Date,default:Date.now},stock:{type:Number,required:!0}}),t.Product=n.default.model("products",t.productSchema)},860:e=>{e.exports=require("express")},185:e=>{e.exports=require("mongoose")}},t={};!function o(r){var n=t[r];if(void 0!==n)return n.exports;var d=t[r]={exports:{}};return e[r].call(d.exports,d,d.exports,o),d.exports}(505)})();