(()=>{"use strict";var e={505:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(752)),o=i(r(1)),s=r(274);if("CLUSTER"===s.mode._[0])if(o.default.isPrimary){console.log("Master cluster setting up");for(let e=0;e<s.numCPUs;e++)o.default.fork();o.default.on("exit",(e=>{console.log(`worker ${e.process.pid} died`)}))}else n.default.listen(s.PORT,(()=>{console.log(`Servidor corriendo en http://localhost:${s.PORT}`)})),console.log(`Worker ${process.pid} started`);else n.default.listen(s.PORT,(()=>{console.log(`Servidor corriendo en http://localhost:${s.PORT}`)}))},752:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(81);const n=i(r(114)),o=i(r(422)),s=i(r(455)),u=i(r(860)),d=i(r(508)),c=i(r(687)),a=(0,u.default)();a.use(u.default.static("public")),a.use(u.default.json()),a.use(u.default.urlencoded({extended:!0})),a.use((0,d.default)({secret:"secreto",cookie:{httpOnly:!1,secure:!1,maxAge:6e5},rolling:!0,resave:!0,saveUninitialized:!1})),a.use(c.default.initialize()),a.use(c.default.session()),a.use((0,s.default)()),a.use("/api/carrito",(new n.default).router),a.use("/api/productos",(new o.default).router),a.set("views","./views"),a.set("view engine","ejs"),t.default=a},913:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serviceAccount=t.sqlite3=t.mariadb=t.mongoDbKey=void 0,r(81),t.mongoDbKey=process.env.MONGO||"mongodb://localhost:27017/ecommerce",t.mariadb={client:"mysql",connection:{host:"127.0.0.1",user:"root",password:"",database:"ecommerce"}},t.sqlite3={client:"sqlite3",connection:{filename:"./src/db/mydb.sqlite"},useNullAsDefault:!0},t.serviceAccount={type:process.env.FIREBASE_type,project_id:process.env.FIREBASE_project_id,private_key_id:process.env.FIREBASE_private_key_id,private_key:process.env.FIREBASE_private_key,client_email:process.env.FIREBASE_client_email,client_id:process.env.FIREBASE_client_id,auth_uri:process.env.FIREBASE_auth_uri,token_uri:process.env.FIREBASE_token_uri,auth_provider_x509_cert_url:process.env.FIREBASE_auth_provider_x509_cert_url,client_x509_cert_url:process.env.FIREBASE_client_x509_cert_url}},89:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=r(147);t.default=class{constructor(e){this.fileName=e,this.config=`./db/${e}`,this.fs=n.promises}createIfNotExist(){return i(this,void 0,void 0,(function*(){try{return yield n.promises.readFile(this.config)}catch(e){if("ENOENT"===e.code)return yield n.promises.writeFile(this.config,"[]").then((()=>{console.log(`No existe ${this.fileName}. Archivo creado.`)})),yield n.promises.readFile(this.config);console.log("Hubo un error",e)}return null}))}}},179:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(509));t.default=class{constructor(e){this.config=e,this.admin=n.default}connect(){n.default.initializeApp({credential:n.default.credential.cert(this.config)}),console.log("Firebase connected")}}},231:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(514));t.default=class{constructor(e){this.knex=(0,n.default)(e)}}},135:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(185));t.default=class{constructor(e){this.config=e}connect(){return i(this,void 0,void 0,(function*(){try{yield o.default.connect(this.config),console.log("MongoDB connected")}catch(e){console.log("MongoDB connection error",e)}}))}}},318:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(81);const o=r(216),s=n(r(22)).default.getInstance().create(process.env.DB,"carts");t.default=class{constructor(){this.postCart=this.postCart.bind(this),this.deleteCart=this.deleteCart.bind(this),this.getCart=this.getCart.bind(this),this.postProduct=this.postProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}postCart(e,t){return i(this,void 0,void 0,(function*(){if(e.user)try{const r=yield s.postCart(e.body,e.user);return r?(yield(0,o.sendWhatsappMessageToAdmin)(e.user.username),yield(0,o.sendWhatsappMessageToCustomer)(e.user.phoneNumber),t.json(`El carrito con el id:${r.id} ha sido agregado`)):t.json({error:"no se pudo agregar el carrito"})}catch(e){return t.status(500).json({error:e.message})}return t.json({error:"debes iniciar sesión para agregar al carrito"})}))}deleteCart(e,t){return i(this,void 0,void 0,(function*(){if(e.user)try{const r=yield s.getCart(e.params.id,e.user);return r?(yield s.deleteCart(r,e.user),t.json(`El carrito con el id:${r.id} ha sido eliminado`)):t.json({error:`el carrito con el id:${e.params.id} no existe`})}catch(e){return t.status(500).json({error:e.message})}return t.json({error:"debes iniciar sesión para eliminar el carrito"})}))}getCart(e,t){return i(this,void 0,void 0,(function*(){if(e.user)try{const r=yield s.getCart(e.params.id,e.user);return r?t.json(r):t.json({error:`el carrito con el id:${e.params.id} no existe`})}catch(e){return t.status(500).json({error:e.message})}return t.json({error:"debes iniciar sesión para ver el carrito"})}))}postProduct(e,t){return i(this,void 0,void 0,(function*(){if(e.user)try{const r=yield s.getCart(e.params.id,e.user);if(r){const i=yield s.postProduct(r,e.body,e.user);return i?t.json(`El producto con el id:${i.id} ha sido agregado`):t.json({error:`el producto no pudo ser agregado al carrito con el id:${e.params.id}`})}return t.json({error:`el carrito con el id:${e.params.id} no existe`})}catch(e){return t.status(500).json({error:e.message})}return t.json({error:"debes iniciar sesión para agregar un producto"})}))}deleteProduct(e,t){return i(this,void 0,void 0,(function*(){if(e.user)try{const r=yield s.getCart(e.params.id,e.user);if(r){const i=yield s.deleteProduct(r,e.params.id_prod,e.user);return i?t.json(`El producto con el id:${i.id} ha sido eliminado`):t.json({error:`el producto con el id:${e.params.id_prod} no existe en el carrito con el id:${e.params.id}`})}return t.json({error:`el carrito con el id:${e.params.id}`})}catch(e){return t.status(500).json({error:e.message})}return t.json({error:"debes iniciar sesión para eliminar un producto"})}))}}},767:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(81);const o=n(r(645)),s=n(r(22)).default.getInstance().create(process.env.DB,"products");t.default=class{constructor(){this.getProducts=this.getProducts.bind(this),this.postProduct=this.postProduct.bind(this),this.getProduct=this.getProduct.bind(this),this.putProduct=this.putProduct.bind(this),this.deleteProduct=this.deleteProduct.bind(this)}getProducts(e,t){return i(this,void 0,void 0,(function*(){if(e.params.id)try{const r=yield s.getProduct(e.params.id);return r?t.json(r):t.json({error:`el producto con el id:${e.params.id} no existe`})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}else try{const e=yield s.getProducts();return e?t.json(e):t.json({error:"no hay productos"})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}}))}getProduct(e,t){return i(this,void 0,void 0,(function*(){try{const r=yield s.getProduct(e.params.id);return r?t.json(r):t.json({error:`el producto con el id:${e.params.id} no existe`})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}}))}postProduct(e,t){return i(this,void 0,void 0,(function*(){try{const r=yield s.postProduct(e.body);return(yield s.getProduct(r.id))?t.json(`El producto con el id:${r.id} ha sido creado`):t.json({error:"no se pudo crear el producto"})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}}))}putProduct(e,t){return i(this,void 0,void 0,(function*(){try{if(yield s.getProduct(e.params.id)){const r=yield s.putProduct(e.params.id,e.body);return t.json(`El producto con el id:${r.id} ha sido actualizado`)}return t.json({error:`el producto con el id:${e.params.id} no existe`})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}}))}deleteProduct(e,t){return i(this,void 0,void 0,(function*(){try{const r=yield s.getProduct(e.params.id);return r?(yield s.deleteProduct(r),t.json(`El producto con el id:${r.id} ha sido eliminado`)):t.json({error:`el producto con el id:${e.params.id} no existe`})}catch(e){return o.default.error(e.message),t.status(500).json({message:e.message})}}))}}},808:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(89));class s extends o.default{constructor(e){super(e)}getCarts(){return i(this,void 0,void 0,(function*(){const e=yield this.createIfNotExist();return e?JSON.parse(e.toString()):e}))}getCart(e){return i(this,void 0,void 0,(function*(){const t=yield this.getCarts(),r=parseInt(e);return t.find((e=>e.id===r))}))}postCart(e){return i(this,void 0,void 0,(function*(){const t=yield this.getCarts(),r={timestamp:(new Date).toString(),products:e};return t.length?r.id=t[t.length-1].id+1:r.id=1,t.push(r),yield this.fs.writeFile(this.config,JSON.stringify(t)),r}))}deleteCart({id:e}){return i(this,void 0,void 0,(function*(){const t=yield this.getCarts(),r=parseInt(e),i=t.filter((e=>e.id!==r));this.fs.writeFile(this.config,JSON.stringify(i))}))}postProduct(e,t){return i(this,void 0,void 0,(function*(){const r=yield this.getCarts(),i=r.find((t=>t.id===e.id));return i?(i.products.push(t),yield this.fs.writeFile(this.config,JSON.stringify(r)),t=e.products.find((e=>e.id===t.id))):null}))}deleteProduct(e,t){return i(this,void 0,void 0,(function*(){const r=yield this.getCarts(),i=parseInt(t),n=r.find((t=>t.id===e.id));return!!n&&(n.products.filter((e=>e.id!==i)),this.fs.writeFile(this.config,JSON.stringify(r)),!0)}))}}t.default=s},792:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(179));class s extends o.default{constructor(e){super(e),this.connect(),this.db=this.admin.firestore(),this.query=this.db.collection("carts")}postCart(e){return i(this,void 0,void 0,(function*(){const t={timestamp:(new Date).toString(),products:[]};e&&!e.length?t.products.push(e):e.length&&(t.products=e);const r=this.query.doc(),i=r._path.segments[1];yield r.create(t);const n=yield this.getCart(i);if(n.products)return n}))}deleteCart(e){return i(this,void 0,void 0,(function*(){const t=this.query.doc(e.id);e.products&&(yield t.delete())}))}getCart(e){return i(this,void 0,void 0,(function*(){const t=yield this.query.doc(e),r=yield t.get(),i=Object.assign({id:t.id},r.data());if(i.title)return i}))}postProduct(e,t){return i(this,void 0,void 0,(function*(){const r=this.admin.firestore.FieldValue.arrayUnion,i=this.query.doc(e.id);return e.products?(yield i.update({products:r(t)}),t):t}))}deleteProduct(e,t){return i(this,void 0,void 0,(function*(){const r=this.query.doc(e.id);let i;if(e.products&&(i=e.products.find((e=>e.id===t))),i){const e=this.admin.firestore.FieldValue.arrayRemove;return yield r.update({products:e(i)}),i}return i}))}}t.default=s},303:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(135)),s=r(794),u=n(r(645));class d extends o.default{constructor(e){super(e),this.connect()}postCart(e,{username:t}){return i(this,void 0,void 0,(function*(){const r=new s.Cart;return yield r.save(((r,i)=>{r&&u.default.error(r),i.username=t,i.products=e,i.save()})),r}))}deleteCart({id:e},{username:t}){return i(this,void 0,void 0,(function*(){yield s.Cart.findOneAndDelete({_id:e,username:t})}))}getCart(e,{username:t}){return i(this,void 0,void 0,(function*(){return yield s.Cart.findOne({_id:e,username:t})}))}postProduct({id:e},t,{username:r}){return i(this,void 0,void 0,(function*(){let i;return yield s.Cart.findOneAndUpdate({_id:e,username:r},{$push:{products:t}},{new:!0}).then((e=>{e&&(i=e.products.find((e=>e._id==t._id)))})),i}))}deleteProduct({id:e},t,{username:r}){return i(this,void 0,void 0,(function*(){let i;return yield s.Cart.findOneAndUpdate({_id:e,username:r},{$pull:{products:{_id:t}}}).then((e=>{e&&(i=e.products.find((e=>e._id==t)))})),i}))}}t.default=d},526:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(231));class s extends o.default{constructor(e){super(e)}createIfNotExists(){return i(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts",(e=>{e.increments("id"),e.string("title"),e.timestamp("timestamp")}))}catch(e){console.log(e.sqlMessage)}}))}createIfNotExistsProducts(){return i(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("carts_products",(e=>{e.integer("id"),e.integer("cart_id"),e.string("title"),e.string("description"),e.string("thumbnail"),e.float("price"),e.integer("stock"),e.string("timestamp")}))}catch(e){console.log(e.sqlMessage)}}))}postCart(e){return i(this,void 0,void 0,(function*(){yield this.createIfNotExists(),yield this.createIfNotExistsProducts();const t=yield this.knex("carts").insert({title:"Carrito"});return e.forEach((e=>{e.cart_id=t[0]})),yield this.knex("carts_products").insert(e),this.getCart(t[0].toString())}))}deleteCart({id:e}){return i(this,void 0,void 0,(function*(){yield this.knex("carts_products").where("cart_id",e).del(),yield this.knex("carts").where("id",e).del()}))}getCart(e){return i(this,void 0,void 0,(function*(){try{const t=(yield this.knex.from("carts").select("*").where("id",e))[0];return t.products=yield this.knex.from("carts_products").select("*").where("cart_id",e),t}catch(e){return console.log(e.sqlMessage),!1}}))}postProduct(e,t){return i(this,void 0,void 0,(function*(){return e.products&&(t.cart_id=e.id),yield this.knex("carts_products").insert(t),t}))}deleteProduct(e,t){return i(this,void 0,void 0,(function*(){const r=yield this.knex.from("carts_products").select("*").where("id",t).andWhere("cart_id",e.id);return yield this.knex("carts_products").where("id",t).andWhere("cart_id",e.id).del(),r[0]}))}}t.default=s},722:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(89));class s extends o.default{constructor(e){super(e)}getProducts(){return i(this,void 0,void 0,(function*(){const e=yield this.createIfNotExist();return e?JSON.parse(e.toString()):e}))}postProduct(e){return i(this,void 0,void 0,(function*(){const t=yield this.getProducts();return t.length?e.id=t[t.length-1].id+1:e.id=1,e.timestamp=(new Date).toString(),t.push(e),yield this.fs.writeFile(this.config,JSON.stringify(t)),e}))}getProduct(e){return i(this,void 0,void 0,(function*(){const t=parseInt(e);return(yield this.getProducts()).find((e=>e.id===t))}))}putProduct(e,t){return i(this,void 0,void 0,(function*(){const r=parseInt(e),i=(yield this.getProducts()).filter((e=>e.id!==r));return t.id=r,i.push(t),yield this.fs.writeFile(this.config,JSON.stringify(i)),t}))}deleteProduct({id:e}){return i(this,void 0,void 0,(function*(){const t=parseInt(e),r=(yield this.getProducts()).filter((e=>e.id!==t));this.fs.writeFile(this.config,JSON.stringify(r))}))}}t.default=s},593:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(179));class s extends o.default{constructor(e){super(e),this.db=this.admin.firestore(),this.query=this.db.collection("products")}getProducts(){return i(this,void 0,void 0,(function*(){return(yield this.query.get()).docs.map((e=>Object.assign({id:e.id},e.data())))}))}postProduct(e){return i(this,void 0,void 0,(function*(){e.timestamp=(new Date).toString();const t=this.query.doc(),r=t._path.segments[1];yield t.create(e);const i=yield this.getProduct(r);if(i.title)return i}))}getProduct(e){return i(this,void 0,void 0,(function*(){const t=this.query.doc(e),r=yield t.get(),i=Object.assign({id:t.id},r.data());if(i.title)return i}))}putProduct(e,t){return i(this,void 0,void 0,(function*(){const r=this.query.doc(e);yield r.update(t);const i=yield this.getProduct(e);if(i.title)return i}))}deleteProduct(e){return i(this,void 0,void 0,(function*(){const t=this.query.doc(e.id);return!!e.title&&(yield t.delete(),!0)}))}}t.default=s},470:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(231));class s extends o.default{constructor(e){super(e)}createIfNotExists(){return i(this,void 0,void 0,(function*(){try{yield this.knex.schema.createTable("products",(e=>{e.increments("id"),e.string("title"),e.string("description"),e.string("thumbnail"),e.float("price"),e.integer("stock"),e.timestamp("timestamp")}))}catch(e){console.log(e.sqlMessage)}}))}getProducts(){return i(this,void 0,void 0,(function*(){return yield this.knex.from("products").select("*")}))}postProduct(e){return i(this,void 0,void 0,(function*(){yield this.createIfNotExists();const t=yield this.knex("products").insert(e);return yield this.getProduct(t[0].toString())}))}getProduct(e){return i(this,void 0,void 0,(function*(){return(yield this.knex.from("products").select("*").where("id",e))[0]}))}putProduct(e,t){return i(this,void 0,void 0,(function*(){return yield this.knex("products").where("id",e).update(t),yield this.getProduct(e)}))}deleteProduct({id:e}){return i(this,void 0,void 0,(function*(){yield this.knex("products").where("id",e).del()}))}}t.default=s},858:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(135)),s=r(489);class u extends o.default{constructor(e){super(e)}getProducts(){return i(this,void 0,void 0,(function*(){return yield s.Product.find({})}))}postProduct(e){return i(this,void 0,void 0,(function*(){const t=new s.Product(e);return yield t.save()}))}getProduct(e){return i(this,void 0,void 0,(function*(){return yield s.Product.findById(e)}))}putProduct(e,t){return i(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndUpdate(e,t)}))}deleteProduct({id:e}){return i(this,void 0,void 0,(function*(){return yield s.Product.findByIdAndRemove(e)}))}}t.default=u},22:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const n=r(913),o=i(r(808)),s=i(r(722)),u=i(r(792)),d=i(r(593)),c=i(r(303)),a=i(r(858)),l=i(r(526)),f=i(r(470));let h,p;class v{create(e,t){switch(e){case"mongoDb":switch(t){case"carts":h=new c.default(n.mongoDbKey);break;case"products":h=new a.default(n.mongoDbKey)}return h;case"firebase":switch(t){case"carts":h=new u.default(n.serviceAccount);break;case"products":h=new d.default(n.serviceAccount)}return h;case"mariaSql":switch(t){case"carts":h=new l.default(n.sqlite3);break;case"products":h=new f.default(n.mariadb)}return h;default:switch(t){case"carts":h=new o.default("carts.json");break;case"products":h=new s.default("products.json")}return h}}static getInstance(){return p||(p=new v),p}}t.Factory=v,t.default=v},794:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cart=void 0;const n=i(r(185)),o=r(489),s=new n.default.Schema({username:{type:String,require:!0},products:[o.productSchema],timestamp:{type:String,default:(new Date).toString()}});t.Cart=n.default.model("carts",s)},489:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.productSchema=void 0;const n=i(r(185));t.productSchema=new n.default.Schema({title:{type:String,required:!0},description:{type:String,required:!0},thumbnail:{type:String,required:!0},price:{type:Number,required:!0},timestamp:{type:String,default:(new Date).toString()},stock:{type:Number,required:!0}}),t.Product=n.default.model("products",t.productSchema)},12:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=r(185),n=new i.Schema({username:{type:String,required:!0},password:{type:String,required:!0},name:{type:String,required:!0},address:{type:String,required:!0},age:{type:Number,required:!0},phoneNumber:{type:String,required:!0},avatar:{type:String,required:!0}}),o=(0,i.model)("users",n);t.default=o},186:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(752)),o=i(r(687)),s=i(r(645));n.default.get("/register",((e,t)=>{t.render("register")})),n.default.post("/register",o.default.authenticate("signup",{successRedirect:"/login",failureRedirect:"/failregister"})),n.default.get("/failregister",((e,t)=>{s.default.info("Fallo al registrar usuario"),t.render("failregister")})),n.default.get("/login",((e,t)=>{t.render("login")})),n.default.post("/login",o.default.authenticate("login",{successRedirect:"/",failureRedirect:"/faillogin"})),n.default.get("/faillogin",((e,t)=>{s.default.info("Fallo al iniciar sesión"),t.render("faillogin")})),n.default.get("/logout",((e,t)=>{if(e.user){const{username:r}=e.user;return e.logOut((e=>e?(s.default.error(e),t.redirect("/login")):t.render("logout",{username:r})))}t.redirect("/login")})),t.default=n.default},114:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(860),o=i(r(318)),s=(0,n.Router)();t.default=class{constructor(){this.router=s,this.cartsController=new o.default,s.use((0,n.json)()),s.use((0,n.urlencoded)({extended:!0})),s.post("/",this.cartsController.postCart),s.delete("/:id",this.cartsController.deleteCart),s.get("/:id/productos",this.cartsController.getCart),s.post("/:id/productos",this.cartsController.postProduct),s.delete("/:id/productos/:id_prod",this.cartsController.deleteProduct)}}},422:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(860),o=i(r(767)),s=i(r(383)),u=(0,n.Router)();t.default=class{constructor(){this.router=u,this.productsController=new o.default,u.use((0,n.json)()),u.use((0,n.urlencoded)({extended:!0})),u.get("/:id?",this.productsController.getProducts),u.post("/",s.default,this.productsController.postProduct),u.put("/:id",s.default,this.productsController.putProduct),u.delete("/:id",s.default,this.productsController.deleteProduct)}}},274:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PORT=t.mode=t.numCPUs=void 0;const n=i(r(566)),o=i(r(37)),s=i(r(186)),u=i(r(645));t.numCPUs=o.default.cpus().length;const d=(0,n.default)(process.argv.slice(2));t.mode=(0,n.default)(process.argv.slice(3)),t.PORT=process.env.PORT||d._[0]||8080,s.default.get("/",((e,t)=>e.user?t.json(e.user):t.redirect("/login"))),s.default.get("/api/randoms",((e,t)=>{const{cant:r}=e.query,i=Number(r)||1e5,n=[];for(let e=0;e<i;e++)n.push(Math.floor(1e3*Math.random()));t.json(n)}));const c={"Argumentos de entrada":process.argv,"Nombre de la plataforma: ":process.platform,"Versión de Node: ":process.version,"Memoria total reservada":process.memoryUsage().heapTotal,"Path de ejecución":process.execPath,"Process id":process.pid,"Número de procesadores presentes en el servidor":"CLUSTER"===t.mode._[0]?t.numCPUs:1,"Carpeta del proyecto":__dirname,Port:t.PORT};s.default.get("/info",((e,t)=>{t.json(c)})),s.default.get("*",((e,t)=>{u.default.warn("Ruta no existente"),t.send("Ruta no existente")}))},383:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){"true"===e.headers.admin?r():t.status(401).json({error:"No autorizado"})}},645:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(773)),o=n.default.createLogger({transports:[new n.default.transports.Console({level:"info"}),new n.default.transports.File({filename:"warn.log",level:"warn"}),new n.default.transports.File({filename:"error.log",level:"error"})]});t.default=o},918:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(184),s=n(r(645)),u=(0,o.createTransport)({service:"gmail",auth:{user:process.env.MAIL,pass:process.env.MAIL_PASSWORD}});t.default=function(e){return i(this,void 0,void 0,(function*(){const t=yield u.sendMail({from:"Servidor de Tienda",port:587,to:process.env.MAIL,subject:"Nuevo registro",html:`<h1>${e}</h1>`});s.default.info(t)}))}},687:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(511)),s=r(55),u=n(r(96)),d=n(r(12)),c=n(r(645)),a=n(r(918));function l(e){return u.default.hashSync(e,u.default.genSaltSync(10),null)}o.default.use("login",new s.Strategy(((e,t,r)=>{d.default.findOne({username:e},((e,i)=>e?r(e):i?function(e,t){return u.default.compareSync(t,e.password)}(i,t)?r(null,i):(c.default.info("Contraseña incorrecta"),r(null,!1)):(c.default.info("Email no encontrado"),r(null,!1))))}))),o.default.use("signup",new s.Strategy({passReqToCallback:!0},(({body:e},t,r,n)=>{d.default.findOne({username:t},((o,s)=>{if(o)return n(o);if(s)return c.default.info("Email ya existe"),n(null,!1);const u=new d.default({username:t,password:l(r),name:e.name,address:e.address,age:e.age,phoneNumber:e.phoneNumber,avatar:e.avatar});u.save((e=>i(void 0,void 0,void 0,(function*(){return e?n(e):(yield(0,a.default)(u),n(null,u))}))))}))}))),o.default.serializeUser((({_id:e},t)=>{t(null,e)})),o.default.deserializeUser(((e,t)=>{d.default.findById(e,((e,r)=>e?t(e):t(null,r)))})),t.default=o.default},216:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function u(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}d((i=i.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendWhatsappMessageToCustomer=t.sendWhatsappMessageToAdmin=void 0;const o=n(r(202)),s=n(r(645)),u=process.env.TWILIO_ACCOUNT_SID,d=process.env.TWILIO_AUTH_TOKEN,c=(0,o.default)(u,d);t.sendWhatsappMessageToAdmin=e=>i(void 0,void 0,void 0,(function*(){try{const t=yield c.messages.create({body:`Nuevo pedido de ${e}!`,from:`whatsapp:${process.env.TWILIO_NUMBER}`,to:`whatsapp:${process.env.MY_PHONE}`});s.default.info(t)}catch(e){s.default.error(e)}})),t.sendWhatsappMessageToCustomer=e=>i(void 0,void 0,void 0,(function*(){try{const t=yield c.messages.create({body:"Su pedido ha sido recibido y se encuentra en proceso!",from:`whatsapp:${process.env.TWILIO_NUMBER}`,to:`whatsapp:${e}`});s.default.info(t)}catch(e){s.default.error(e)}}))},96:e=>{e.exports=require("bcrypt")},455:e=>{e.exports=require("compression")},81:e=>{e.exports=require("dotenv/config")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},509:e=>{e.exports=require("firebase-admin")},514:e=>{e.exports=require("knex")},566:e=>{e.exports=require("minimist")},185:e=>{e.exports=require("mongoose")},184:e=>{e.exports=require("nodemailer")},511:e=>{e.exports=require("passport")},55:e=>{e.exports=require("passport-local")},202:e=>{e.exports=require("twilio")},773:e=>{e.exports=require("winston")},1:e=>{e.exports=require("cluster")},147:e=>{e.exports=require("fs")},37:e=>{e.exports=require("os")}},t={};!function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,r),o.exports}(505)})();